# 网络协议01

<p align='center'>
<img src='https://github.com/w1991668899/blog/blob/master/image/go/%E5%8D%8F%E8%AE%AE%E8%AE%B2%E8%A7%A3.jpg'>
</p>

参考:

- 《图解TCP/IP》
- 《TPC/IP指南》
- 《高性能Linux》
- 《wiki百科》

一直感觉自己在网络协议协议方面有一种似懂非懂的感觉，于是最近趁着有时间集中看了一些书跟文章，现在结合自己的理解与实践做一些总结,以便形成体系认识.

# 网络分层

## 七层模型

- 物理层: 主要定义物理设备标准，如网线/光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比特流（就是由1、0转化为电流强弱来进行传输，到达目的地后再转化为1、0，也就是我们常说的数模转换与模数转换）。这一层的数据叫做比特

- 数据链路层: 定义了如何让格式化数据以帧为单位进行传输，以及如何让控制对物理介质的访问。这一层通常还提供错误检测和纠正，以确保数据的可靠传输

- 网络层: 在位于不同地理位置的网络中的两个主机系统之间提供连接和路径选择

- 传输层: 定义了一些传输数据的协议和端口号

- 会话层: 通过传输层(端口号：传输端口与接收端口)建立数据传输的通路

- 表示层: 可确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取

- 应用层: 是最靠近用户的OSI层。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务

## TCP/IP四层模型

- 应用层（Application)

- 传输层（Transport）

- 网络层（Network）

- 链路层（Link）

# 描述web页面的一次完整的请求过程

- >在浏览器输入URI后 https://www.baidu.com 
- 浏览器搜索自身DNS缓存/读取系统 `hosts` 文件/发起DNS/HTTPDNS系统调用获取域名对应IP，并返回给客户端系统内核，内核返回给浏览器。浏览器拿到IP将应用层的包交给传输层去完成。
- 传输层封装完毕将包交给网络层，网络层通过socket接口实现，这里使用TCP协议,TCP协议有两个端口，一个是浏览器的监听端口，一个是服务器的监听端口。操作系统通过端口识别包属于哪个进程。
- 网络层是IP协议，IP协议中会有客户端IP和服务端IP。操作系统启动的时候会被DHCP协议配置IP地址，以及默认的网管IP：192.168.1.1。
  客户端系统会判断封装的服务端IP是否是本地IP。如果在本地则通过ARP协议获取MAC地址进入MAC层.
- 网卡将包发出去到达网关。网关收到包后会判断下一步怎么走。网关相当于一个路由器，到某个IP地址应该怎么走，这个叫路由表。每个网关后面则相当于服务端的一个内部局域网，都可以使用本地MAC通信。当到达最后一个网关就需要解析出IP头，匹配正确后进入TCP层
- TCP中有目标端口可以找到正在运行的服务进程, 然后解析HTTP进行处理,最后返回。

# TCP与UDP的区别

- **TCP提供可靠交付** tcp连接传输的数据，无差错、不丢失、不重复、按序到达，udp继承了ip包的特性，无法保证不丢失与按序到达
- **TCP面向字节流** tcp发送的时候是字节流，没头没尾。IP包不是流而是一个个ip包。流是tcp自己的状态维护。udp继承ip的特性，基于数据报，一个一个发，一个一个收。
- **TCP可以有拥塞控制** 当包丢失或网络环境不好会调整发送速度，udp没有这些。
- **TCP是有状态服务**  tcp精确记录是否发送/接受，发送到哪/接受到哪， udp则无状态




  




